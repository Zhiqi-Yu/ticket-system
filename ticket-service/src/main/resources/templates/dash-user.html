<!doctype html><html><head><meta charset="UTF-8"><title>User</title></head>
<body>
<h3>User Dashboard</h3>
<a href="/logout">Logout</a><hr>

<label>Title <input id="title" value="Demo Ticket"></label>
<label>Description <input id="desc" value="just a test"></label>
<label>Priority
    <select id="prio"><option>LOW</option><option selected>MEDIUM</option><option>HIGH</option></select>
</label>
<label>Category <input id="cat" value="IT"></label>
<button id="btnCreate">Create</button>

<hr>
<label>Ticket ID <input id="tid" placeholder="id"></label>
<button id="btnGet">Get</button>
<button id="btnClose">Close</button>
<button id="btnReopen">Reopen</button>

<pre id="out" style="background:#f5f5f5;padding:8px"></pre>

<script>
    const out = document.getElementById('out'), tid = document.getElementById('tid');
    tid.value = localStorage.lastTicketId || '';
    function show(x){ out.textContent = JSON.stringify(x,null,2); if(x && x.id){ tid.value=x.id; localStorage.lastTicketId=x.id; } }
    async function api(path, method='GET', body){
        const r = await fetch(path,{method,headers:{'Content-Type':'application/json'},body:body?JSON.stringify(body):undefined});
        if(!r.ok){ show({error:r.status, text:await r.text()}); throw 0; } return r.json();
    }
    document.getElementById('btnCreate').onclick = async ()=>{
        const data={title: title.value, description: desc.value, priority: prio.value, category: cat.value};
        show(await api('/api/tickets','POST',data));
    };
    btnGet.onclick    = async ()=> show(await api(`/api/tickets/${tid.value}`));
    btnClose.onclick  = async ()=> show(await api(`/api/tickets/${tid.value}/close` ,'POST',{comments:'ok'}));
    btnReopen.onclick = async ()=> show(await api(`/api/tickets/${tid.value}/reopen`,'POST',{comments:'need more work'}));
</script>
</body></html>
